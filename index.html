// 禁用右键菜单
document.oncontextmenu = function() { return false; };

// 禁用 F12 和常用开发者快捷键
document.onkeydown = function(e) {
    if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) {
        return false;
    }
};
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九紫离火·宇宙请示器</title>
    <style>
        body { background-color: #0d0210; color: #ff3366; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; font-family: "PingFang SC", "Microsoft YaHei", sans-serif; }
        .container { text-align: center; border: 2px solid #7000ff; padding: 25px; border-radius: 25px; box-shadow: 0 0 40px rgba(112, 0, 255, 0.3); background: rgba(0,0,0,0.9); width: 100%; max-width: 500px; box-sizing: border-box; transition: all 0.3s; }
        
        /* 主卦象区域 */
        #gua-symbol-container { height: 120px; display: flex; align-items: center; justify-content: center; margin: 10px 0; overflow: hidden; }
        #gua-symbol { font-size: 90px; color: #bc13fe; text-shadow: 0 0 20px #bc13fe; transition: transform 0.3s, color 0.3s, text-shadow 0.3s; will-change: transform, opacity; }
        
        .gua-title { font-size: 28px; font-weight: bold; color: #ff3366; margin: 5px 0; min-height: 38px; }
        .section-box { background: rgba(112, 0, 255, 0.1); padding: 12px; border-radius: 8px; margin: 12px 0; border-left: 3px solid #7000ff; text-align: left; }
        .label { font-size: 11px; color: #9d46ff; font-weight: bold; text-transform: uppercase; margin-bottom: 4px; display: block; letter-spacing: 1px; }
        .content { font-size: 15px; color: #eee; line-height: 1.6; font-weight: 300; text-align: justify; }
        .xiaoxiang-box { text-align: left; margin-top: 15px; border-top: 1px solid #333; padding-top: 15px; }
        .xiaoxiang-grid { display: grid; grid-template-columns: 1fr; gap: 8px; } /* 手机端改为单列显示，避免文字拥挤 */
        .xiaoxiang-item { font-size: 13px; color: #ccc; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; line-height: 1.4; }
        
        button { background: linear-gradient(45deg, #7000ff, #ff0055); border: none; color: white; padding: 16px 0; font-size: 18px; font-weight: bold; border-radius: 50px; cursor: pointer; width: 100%; margin-top: 15px; box-shadow: 0 5px 20px rgba(255, 0, 85, 0.4); transition: all 0.3s; }
        button:active { transform: scale(0.98); }
        button:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed; transform: none; }

        .hidden { display: none; }

        /* 思考动画 */
        .container.thinking #gua-symbol {
            animation: energyPulse 0.6s infinite alternate ease-in-out;
            color: #ff1a1a; 
            text-shadow: 0 0 40px #ff1a1a, 0 0 60px #7000ff;
        }
        @keyframes energyPulse {
            0% { transform: scale(0.95); opacity: 0.8; filter: blur(1px); }
            100% { transform: scale(1.05); opacity: 1; filter: blur(0px); }
        }
        /* 揭晓动画 */
        .reveal-anim { animation: revealFlash 0.5s ease-out; }
        @keyframes revealFlash {
            0% { transform: scale(1.5); opacity: 0; }
            50% { transform: scale(1.5); opacity: 0.5; color: #fff; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

<div class="container" id="main-container">
    <div style="color: #666; font-size: 12px; margin-bottom: 5px;">道之占卜 · 推演</div>
    <div id="gua-symbol-container">
        <div id="gua-symbol">䷀</div>
    </div>
    <div id="gua-name" class="gua-title">静思所求，请道指引</div>
    
    <div id="result-area" class="hidden">
        <div class="section-box">
            <span class="label">【卦辞 · 总纲】</span>
            <div id="gua-judgment" class="content"></div>
        </div>
        <div class="section-box" style="border-left-color: #ff3366;">
            <span class="label">【大象 · 宏观】</span>
            <div id="gua-daxiang" class="content"></div>
        </div>
        <div class="xiaoxiang-box">
            <span class="label" style="margin-bottom:8px">【小象 · 六爻指引】</span>
            <div id="xiaoxiang-list" class="xiaoxiang-grid"></div>
        </div>
    </div>

    <button id="draw-btn" onclick="startThinkingProcess()">开启宇宙能量请卦</button>
</div>

<script>
// 经过严格校对的完整64卦数据库 (包含完整的象传解释)
const GUA_DATA = [
    {n:"乾为天",s:"䷀",j:"元亨利贞。",dx:"天行健，君子以自强不息。",xx:["潜龙勿用，阳在下也","见龙在田，德施普也","终日乾乾，反复道也","或跃在渊，进无咎也","飞龙在天，大人造也","亢龙有悔，盈不可久"]},
    {n:"坤为地",s:"䷁",j:"元亨，利牝马之贞。",dx:"地势坤，君子以厚德载物。",xx:["履霜坚冰，阴始凝也","直方大，不习无不利","含章可贞，以时发也","括囊无咎，慎不害也","黄裳元吉，文在中也","龙战于野，其道穷也"]},
    {n:"水雷屯",s:"䷂",j:"元亨利贞。勿用有攸往。利建侯。",dx:"云雷，屯；君子以经纶。",xx:["虽磐桓，志行正也","六二之难，乘刚也","即鹿无虞，以从禽也","求而往，明也","屯其膏，施未光也","乘马班如，泣血涟如"]},
    {n:"山水蒙",s:"䷃",j:"亨。匪我求童蒙，童蒙求我。初筮告，再三渎，渎则不告。利贞。",dx:"山下出泉，蒙；君子以果行育德。",xx:["利用刑人，以正法也","子克家，刚柔接也","勿用取女，行不顺也","困蒙之吝，独远实也","童蒙之吉，顺以巽也","利用御寇，上下顺也"]},
    {n:"水天需",s:"䷄",j:"有孚，光亨，贞吉。利涉大川。",dx:"云上于天，需；君子以饮食宴乐。",xx:["需于郊，不犯难行也","需于沙，衍在中也","需于泥，灾外至也","需于血，顺以听也","酒食贞吉，以中正也","不速之客来，敬之终吉"]},
    {n:"天水讼",s:"䷅",j:"有孚，窒惕，中吉，终凶。利见大人，不利涉大川。",dx:"天与水违行，讼；君子以作事谋始。",xx:["不永所事，讼不可长也","不克讼，归逋窜也","食旧德，从上吉也","复即命，变安贞也","讼元吉，以中正也","以讼受服，亦不足敬也"]},
    {n:"地水师",s:"䷆",j:"贞，丈人吉，无咎。",dx:"地中有水，师；君子以容民畜众。",xx:["师出以律，失律凶也","在师中吉，承天宠也","师或舆尸，大无功也","左次无咎，未失常也","长子帅师，以中行也","大君有命，以正功也"]},
    {n:"水地比",s:"䷇",j:"吉。原筮，元永贞，无咎。不宁方来，后夫凶。",dx:"地上有水，比；先王以建万国，亲诸侯。",xx:["有孚比之，无咎有它也","比之自内，不自失也","比之匪人，不亦伤乎","外比于贤，以从上也","显比之吉，位正中也","比之无首，无所终也"]},
    {n:"风天小畜",s:"䷈",j:"亨。密云不雨，自我西郊。",dx:"风行天上，小畜；君子以懿文德。",xx:["复自道，其义吉也","牵复在中，亦不自失也","夫妻反目，不能正室也","有孚惕出，上合志也","有孚挛如，不独富也","既雨既处，德积载也"]},
    {n:"天泽履",s:"䷉",j:"履虎尾，不咥人，亨。",dx:"上天下泽，履；君子以辨上下，定民志。",xx:["素履之往，独行愿也","幽人贞吉，中不自乱也","眇能视，不足以有明也","愬愬终吉，志行也","夬履贞厉，位正当也","元吉在上，大有庆也"]},
    {n:"地天泰",s:"䷊",j:"小往大来，吉亨。",dx:"天地交，泰；后以财成天地之道，辅相天地之宜。",xx:["拔茅征吉，志在外也","包荒，得尚于中行也","无往不复，天地际也","翩翩不富，皆失实也","以祉元吉，中以行也","城复于隍，其命乱也"]},
    {n:"天地否",s:"䷋",j:"否之匪人，不利君子贞，大往小来。",dx:"天地不交，否；君子以俭德辟难，不可荣以禄。",xx:["拔茅贞吉，志在君也","包承，小人吉也","包羞，位不当也","有命无咎，志行也","大人之吉，位正当也","否终则倾，何可长也"]},
    {n:"天火同人",s:"䷌",j:"同人于野，亨。利涉大川，利君子贞。",dx:"天与火，同人；君子以类族辨物。",xx:["出门同人，又谁咎也","同人于宗，吝道也","伏戎于莽，敌刚也","乘其墉，义弗克也","同人先号，中直也","同人于郊，志未得也"]},
    {n:"火天大有",s:"䷍",j:"元亨。",dx:"火在天上，大有；君子以遏恶扬善，顺天休命。",xx:["大有初九，无交害也","大舆以载，积中不败也","公用亨于天子，小人害也","匪其彭无咎，明辨晰也","厥孚交如，信以发志也","大有上吉，自天佑也"]},
    {n:"地山谦",s:"䷎",j:"亨，君子有终。",dx:"地中有山，谦；君子以裒多益寡，称物平施。",xx:["谦谦君子，卑以自牧也","鸣谦贞吉，中心得也","劳谦君子，万民服也","无不利撝谦，不违则也","利用侵伐，征不服也","鸣谦，志未得也"]},
    {n:"雷地豫",s:"䷏",j:"利建侯行师。",dx:"雷出地奋，豫；先王以作乐崇德，殷荐之上帝，以配祖考。",xx:["初六鸣豫，志穷凶也","不终日，中正也","盱豫有悔，位不当也","由豫大有得，志大行也","六五贞疾，乘刚也","冥豫在上，何可长也"]},
    {n:"泽雷随",s:"䷐",j:"元亨利贞，无咎。",dx:"泽中有雷，随；君子以向晦入宴息。",xx:["官有渝，从正吉也","系小子，弗兼与也","系丈夫，志舍下也","随有获，其义凶也","孚于嘉吉，位正中也","拘系之，上穷也"]},
    {n:"山风蛊",s:"䷑",j:"元亨，利涉大川。先甲三日，后甲三日。",dx:"山下有风，蛊；君子以振民育德。",xx:["干父之蛊，意承考也","干母之蛊，得中道也","干父之蛊，终无咎也","裕父之蛊，往见吝也","干父用誉，承以德也","不事王侯，志可则也"]},
    {n:"地泽临",s:"䷒",j:"元亨利贞。至于八月有凶。",dx:"泽上有地，临；君子以教思无穷，容保民无疆。",xx:["咸临贞吉，志行正也","咸临，吉无不利，未顺命也","甘临，位不当也","至临无咎，位当也","大君之宜，行中之谓也","敦临之吉，志在内也"]},
    {n:"风地观",s:"䷓",j:"盥而不荐，有孚颙若。",dx:"风行地上，观；先王以省方观民设教。",xx:["初六童观，小人道也","窥观女贞，亦可丑也","观我生进退，未失道也","观国之光，尚宾也","观我生，观民也","观其生，志未平也"]},
    {n:"火雷噬嗑",s:"䷔",j:"亨。利用狱。",dx:"雷电噬嗑；先王以明罚敕法。",xx:["屦校灭趾，不行也","噬肤灭鼻，乘刚也","遇毒，位不当也","利艰贞吉，未光也","贞厉无咎，得当也","何校灭耳，聪不明也"]},
    {n:"山火贲",s:"䷕",j:"亨。小利有攸往。",dx:"山下有火，贲；君子以明庶政，无敢折狱。",xx:["舍车而徒，义弗乘也","贲其须，与上兴也","永贞之吉，终莫之陵也","六四当位，疑也","六五之吉，有喜也","白贲无咎，上得志也"]},
    {n:"山地剥",s:"䷖",j:"不利有攸往。",dx:"山附于地，剥；上以厚下安宅。",xx:["剥床以足，灭下也","剥床以辨，未有与也","剥之无咎，失上下也","剥床以肤，切近灾也","以宫人宠，终无尤也","君子得舆，民所载也"]},
    {n:"地雷复",s:"䷗",j:"亨。出入无疾，朋来无咎。反复其道，七日来复，利有攸往。",dx:"雷在地中，复；先王以至日闭关，商旅不行，后不省方。",xx:["不远之复，以修身也","休复之吉，以下仁也","频复之厉，义无咎也","中行独复，以从道也","敦复无悔，中以自考也","迷复之凶，反君道也"]},
    {n:"天雷无妄",s:"䷘",j:"元亨利贞。其匪正有眚，不利有攸往。",dx:"天下雷行，物与无妄；先王以茂对时，育万物。",xx:["无妄之往，得志也","不耕获，未富也","行人得牛，邑人灾也","可贞无咎，固有之也","无妄之药，不可试也","无妄之行，穷之灾也"]},
    {n:"山天大畜",s:"䷙",j:"利贞。不家食吉，利涉大川。",dx:"天在山中，大畜；君子以多识前言往行，以畜其德。",xx:["有厉利已，不犯灾也","舆说輹，中无尤也","利有攸往，上合志也","六四元吉，有喜也","六五之吉，有庆也","何天之衢，道大行也"]},
    {n:"山雷颐",s:"䷚",j:"贞吉。观颐，自求口实。",dx:"山下有雷，颐；君子以慎言语，节饮食。",xx:["观我朵颐，亦不足贵也","颠颐于下，行失类也","十年勿用，道大悖也","颠颐之吉，上施光也","居贞之吉，顺以从上也","由颐厉吉，大有庆也"]},
    {n:"泽风大过",s:"䷛",j:"栋桡。利有攸往，亨。",dx:"泽灭木，大过；君子以独立不惧，遁世无闷。",xx:["藉用白茅，柔在下也","老夫女妻，过以相与也","栋桡之凶，不可以有辅也","栋隆之吉，不桡乎下也","枯杨生华，何可久也","过涉灭顶，不可咎也"]},
    {n:"坎为水",s:"䷜",j:"习坎，有孚，维心亨，行有尚。",dx:"水流而不盈，行险而不失其信。君子以常德行，习教事。",xx:["习坎入坎，失道凶也","求小得，未出中也","来之坎坎，终无功也","樽酒簋贰，刚柔际也","坎不盈，中未大也","六三失道，凶三岁也"]},
    {n:"离为火",s:"䷝",j:"利贞，亨。畜牝牛，吉。",dx:"明两作离，大人以继明照于四方。",xx:["履错之敬，以辟咎也","黄离元吉，得中道也","日昃之离，何可久也","突如其来如，无所容也","六五之吉，离王公也","王用出征，以正邦也"]},
    {n:"泽山咸",s:"䷞",j:"亨，利贞。取女吉。",dx:"山上有泽，咸；君子以虚受人。",xx:["咸其拇，志在外也","虽凶居吉，顺不害也","咸其股，亦不处也","贞吉悔亡，未感害也","咸其脢，志末也","咸其辅颊舌，滕口说也"]},
    {n:"雷风恒",s:"䷟",j:"亨，无咎，利贞。利有攸往。",dx:"雷风，恒；君子以立不易方。",xx:["浚恒之凶，始求深也","九二悔亡，能久中也","不恒其德，无所容也","久非其位，安得禽也","妇人吉，从一而终也","振恒在上，大无功也"]},
    {n:"天山遁",s:"䷠",j:"亨，小利贞。",dx:"天下有山，遁；君子以远小人，不恶而严。",xx:["遁尾之厉，不往何灾也","执用黄牛，固志也","系遁之疾，有疾惫也","君子好遁，小人否也","嘉遁贞吉，以正志也","肥遁无不利，无所疑也"]},
    {n:"雷天大壮",s:"䷡",j:"利贞。",dx:"雷在天上，大壮；君子以非礼弗履。",xx:["壮于趾，其孚穷也","九二贞吉，以中也","小人用壮，君子用罔也","藩决不羸，尚往也","丧羊于易，位不当也","不能退，不详也"]},
    {n:"火地晋",s:"䷢",j:"康侯用锡马蕃庶，昼日三接。",dx:"明出地上，晋；君子以自昭明德。",xx:["晋如摧如，独行正也","受兹介福，以中正也","众允之，志上行也","鼫鼠贞厉，位不当也","失得勿恤，往有庆也","维用伐邑，道未光也"]},
    {n:"地火明夷",s:"䷣",j:"利艰贞。",dx:"明入地中，明夷；君子以莅众用晦而明。",xx:["君子于行，义不食也","六二之吉，顺以则也","南狩之志，乃大得也","入于左腹，获心意也","箕子之贞，明不可息也","初登于天，照四国也"]},
    {n:"风火家人",s:"䷤",j:"利女贞。",dx:"风自火出，家人；君子以言有物而行有恒。",xx:["闲有家，志未变也","六二之吉，顺以巽也","家人嗃嗃，未失也","富家大吉，顺在位也","王假有家，交相爱也","威如之吉，反身之谓也"]},
    {n:"火泽睽",s:"䷥",j:"小事吉。",dx:"上火下泽，睽；君子以同而异。",xx:["见恶人，以辟咎也","遇主于巷，未失道也","见舆曳，位不当也","交孚无咎，志行也","厥宗噬肤，往有庆也","遇雨之吉，群疑亡也"]},
    {n:"水山蹇",s:"䷦",j:"利西南，不利东北。利见大人，贞吉。",dx:"山上有水，蹇；君子以反身修德。",xx:["往蹇来誉，宜待也","王臣蹇蹇，终无尤也","往蹇来反，内喜也","往蹇来连，当位实也","大蹇朋来，以中节也","往蹇来硕，志在内也"]},
    {n:"雷水解",s:"䷧",j:"利西南。无所往，其来复吉。有攸往，夙吉。",dx:"雷雨作，解；君子以赦过宥罪。",xx:["刚柔之际，义无咎也","九二贞吉，得中道也","负且乘，亦可丑也","解而拇，未当位也","君子有解，小人退也","公用射隼，以解悖也"]},
    {n:"山泽损",s:"䷨",j:"有孚，元吉，无咎，可贞。利有攸往。曷之用，二簋可用享。",dx:"山下有泽，损；君子以惩忿窒欲。",xx:["已事遄往，尚合志也","九二利贞，中以为志也","一人行，三则疑也","损其疾，亦可喜也","六五元吉，自上佑也","弗损益之，大得志也"]},
    {n:"风雷益",s:"䷩",j:"利有攸往。利涉大川。",dx:"风雷，益；君子以见善则迁，有过则改。",xx:["元吉无咎，下不厚也","或益之，自外来也","益之用凶事，固有之也","告公从，以益志也","有孚惠心，勿问之矣","莫益之，偏辞也"]},
    {n:"泽天夬",s:"䷪",j:"扬于王庭，孚号有厉，告自邑。不利即戎，利有攸往。",dx:"泽上于天，夬；君子以施禄及下，居德则忌。",xx:["不胜而往，咎也","有戎勿恤，得中道也","壮于頄，终不可长也","臀无肤，位不当也","苋陆夬夬，中未光也","无号之凶，终不可长也"]},
    {n:"天风姤",s:"䷫",j:"女壮，勿用取女。",dx:"天下有风，姤；后以施命诰四方。",xx:["系于金柅，柔道牵也","包有鱼，义不及宾也","其行次且，行未牵也","无鱼之凶，远民也","九五含章，中正也","姤其角，上穷吝也"]},
    {n:"泽地萃",s:"䷬",j:"亨。王假有庙，利见大人，亨，利贞。用大牲吉，利有攸往。",dx:"泽上于地，萃；君子以除戎器，戒不虞。",xx:["乃乱乃萃，其志乱也","引吉无咎，中未变也","往无咎，上巽也","大吉无咎，位不当也","萃有位，志未光也","赍咨涕洟，未安上也"]},
    {n:"地风升",s:"䷭",j:"元亨，用见大人，勿恤，南征吉。",dx:"地中生木，升；君子以顺德，积小以高大。",xx:["允升大吉，上合志也","九二之孚，有喜也","升虚邑，无所疑也","王用亨于岐山，顺事也","贞吉升阶，大得志也","冥升在上，消不富也"]},
    {n:"泽水困",s:"䷮",j:"亨，贞，大人吉，无咎，有言不信。",dx:"泽无水，困；君子以致命遂志。",xx:["入于幽谷，不明也","困于酒食，中有庆也","据于蒺藜，乘刚也","来徐徐，志在下也","劓刖，志未得也","困于葛藟，未当也"]},
    {n:"水风井",s:"䷯",j:"改邑不改井，无丧无得，往来井井。汔至，亦未繘井，羸其瓶，凶。",dx:"木上有水，井；君子以劳民劝相。",xx:["井泥不食，下也","井谷射鲋，无与也","井渫不食，行恻也","井甃无咎，修井也","寒泉之食，中正也","元吉在上，大成也"]},
    {n:"泽火革",s:"䷰",j:"己日乃孚，元亨利贞，悔亡。",dx:"泽中有火，革；君子以治历明时。",xx:["巩用黄牛，不可以有为也","巳日革之，行有嘉也","革言三就，又何之矣","改命之吉，信志也","大人虎变，其文炳也","君子豹变，其文蔚也"]},
    {n:"火风鼎",s:"䷱",j:"元吉，亨。",dx:"木上有火，鼎；君子以正位凝命。",xx:["鼎颠趾，利出否也","鼎有实，慎所之也","鼎耳革，失其义也","覆公餗，信如何也","鼎黄耳，中以为实也","玉铉在上，刚柔节也"]},
    {n:"震为雷",s:"䷲",j:"亨。震惊百里，不丧匕鬯。",dx:"这里的雷，震；君子以恐惧修省。",xx:["震来虩虩，恐致福也","震来厉，乘刚也","震苏苏，位不当也","震遂泥，未光也","震往来厉，危行也","震索索，中未得也"]},
    {n:"艮为山",s:"䷳",j:"艮其背，不获其身，行其庭，不见其人，无咎。",dx:"兼山，艮；君子以思不出其位。",xx:["艮其趾，未失正也","不拯其随，未退听也","艮其限，危熏心也","艮其身，止诸躬也","艮其辅，以中正也","敦艮之吉，以厚终也"]},
    {n:"风山渐",s:"䷴",j:"女归吉，利贞。",dx:"山上有木，渐；君子以居贤德善俗。",xx:["小子之厉，义无咎也","饮食衎衎，不素饱也","夫征不复，离群丑也","或得其桷，顺以巽也","终莫之胜，得所愿也","其羽可用为仪，不可乱也"]},
    {n:"雷泽归妹",s:"䷵",j:"征凶，无攸利。",dx:"泽上有雷，归妹；君子以永终知敝。",xx:["归妹以娣，以恒也","利幽人之贞，未变常也","归妹以须，未当也","愆期之志，有待而行也","帝乙归妹，不如其娣之袂良也","上六无实，承虚筐也"]},
    {n:"雷火丰",s:"䷶",j:"亨，王假之。日中则昃。",dx:"雷电皆至，丰；君子以折狱致刑。",xx:["虽旬无咎，过旬灾也","有孚发若，信以发志也","丰其沛，不可大事也","丰其蔀，位不当也","六五之吉，有庆也","丰其屋，天际翔也"]},
    {n:"火山旅",s:"䷷",j:"小亨，旅贞吉。",dx:"山上有火，旅；君子以明慎用刑。",xx:["旅琐琐，志穷灾也","得童仆贞，终无尤也","旅焚其次，亦以伤也","旅于处，未得位也","终以誉命，上逮也","以旅在上，其义焚也"]},
    {n:"巽为风",s:"䷸",j:"小亨，利攸往，利见大人。",dx:"随风，巽；君子以申命行事。",xx:["进退，志疑也","纷若之吉，得中也","频巽之吝，志穷也","悔亡，有功也","九五之吉，位正中也","巽在床下，上穷也"]},
    {n:"兑为泽",s:"䷹",j:"亨，利贞。",dx:"丽泽，兑；君子以朋友讲习。",xx:["和兑之吉，行未疑也","孚兑之吉，信志也","来兑之凶，位不当也","九四之喜，有庆也","孚于剥，位正当也","上六引兑，未光也"]},
    {n:"风水涣",s:"䷺",j:"亨，利涉大川，利贞。",dx:"风行水上，涣；先王以享于帝立庙。",xx:["初六之吉，顺也","涣奔其机，得愿也","涣其躬，志在外也","涣其群，光大也","王居无咎，正位也","涣其血，远害也"]},
    {n:"水泽节",s:"䷻",j:"亨，苦节不可贞。",dx:"泽上有水，节；君子以制数度，议德行。",xx:["不出户庭，知通塞也","不出门庭，失时极也","不节之嗟，又谁咎也","安节之亨，承上道也","甘节之吉，居位中也","苦节贞凶，其道穷也"]},
    {n:"风泽中孚",s:"䷼",j:"豚鱼吉，利涉大川，利贞。",dx:"泽上有风，中孚；君子以议狱缓死。",xx:["初九虞吉，志未变也","其子和之，中心愿也","得敌，亦可丑也","马匹亡，绝类上也","有孚挛如，位正当也","翰音登于天，何可长也"]},
    {n:"雷山小过",s:"䷽",j:"亨，利贞。可小事不可大事。飞鸟遗之音，不宜上宜下，大吉。",dx:"山上有雷，小过；君子以行过乎恭，丧过乎哀，用过乎俭。",xx:["飞鸟以凶，不可如何也","不及其君，臣不可过也","从或戕之，凶如何也","弗过遇之，位不当也","密云不雨，已上也","弗遇过之，已亢也"]},
    {n:"水火既济",s:"䷾",j:"亨小，利贞。初吉终乱。",dx:"水在火上，既济；君子以思患而预防之。",xx:["曳其轮，义无咎也","七日得，以中道也","三年克之，惫也","终日戒，有所疑也","东邻杀牛，不如西邻之时也","濡其首，何可久也"]},
    {n:"火水未济",s:"䷿",j:"亨。小狐汔济，濡其尾，无攸利。",dx:"火在水上，未济；君子以慎辨物居方。",xx:["濡其尾，亦不知极也","九二贞吉，中以行正也","未济征凶，位不当也","贞吉悔亡，志行也","君子之光，其晖吉也","饮酒濡首，亦不知节也"]}
];

let isThinking = false; // 防止重复点击的状态锁

function startThinkingProcess() {
    if (isThinking) return; // 如果正在思考，阻止再次点击

    // 1. 初始化状态
    isThinking = true;
    const button = document.getElementById('draw-btn');
    const resultArea = document.getElementById('result-area');
    const container = document.getElementById('main-container');
    const symbolEl = document.getElementById('gua-symbol');
    const nameEl = document.getElementById('gua-name');

    // 禁用按钮，隐藏结果，开始动画
    button.disabled = true;
    button.innerText = "请示天之玄机暗示中...";
    resultArea.classList.add('hidden');
    container.classList.add('thinking'); // 添加CSS动画类
    symbolEl.classList.remove('reveal-anim'); // 移除之前的揭晓动画

    let shuffleCount = 0;
    const totalTime = 3000; // 总共3秒
    const intervalTime = 60; // 每60毫秒切换一次

    // 2. 快速切换的思考过程 (setInterval)
    const shuffleTimer = setInterval(() => {
        // 随机显示临时的卦象和名称
        const tempIdx = Math.floor(Math.random() * 64);
        symbolEl.innerText = GUA_DATA[tempIdx].s;
        // 让颜色也随机闪烁
        symbolEl.style.color = Math.random() > 0.5 ? "#ff1a1a" : "#bc13fe";
        nameEl.innerText = "推演中... [" + GUA_DATA[tempIdx].s + "]";
        shuffleCount += intervalTime;
    }, intervalTime);


    // 3. 思考结束，揭晓结果 (setTimeout)
    setTimeout(() => {
        clearInterval(shuffleTimer); // 停止闪烁

        // 抽取最终结果
        const finalIdx = Math.floor(Math.random() * 64);
        const finalData = GUA_DATA[finalIdx];

        // 渲染最终结果
        renderFinalResult(finalData, finalIdx);

        // 恢复UI状态
        container.classList.remove('thinking'); // 停止能量脉冲动画
        button.disabled = false;
        button.innerText = "再次开启九紫能量";
        isThinking = false; // 解锁状态

    }, totalTime);
}

// 辅助函数：渲染最终结果
function renderFinalResult(data, idx) {
    const symbolEl = document.getElementById('gua-symbol');
    const nameEl = document.getElementById('gua-name');
    const resultArea = document.getElementById('result-area');

    // 1. 设置文本
    symbolEl.innerText = data.s;
    nameEl.innerText = (idx + 1) + ". " + data.n;
    document.getElementById('gua-judgment').innerText = data.j;
    document.getElementById('gua-daxiang').innerText = data.dx;
    
    // 2. 生成小象列表
    const list = document.getElementById('xiaoxiang-list');
    list.innerHTML = "";
    const lines = ["初爻", "二爻", "三爻", "四爻", "五爻", "上爻"];
    data.xx.forEach((text, i) => {
        const item = document.createElement('div');
        item.className = 'xiaoxiang-item';
        item.innerText = lines[i] + "：" + text;
        list.appendChild(item);
    });

    // 3. 设置最终颜色（离火运彩蛋）
    if (data.n === "离为火") {
        symbolEl.style.color = "#ff0000";
        symbolEl.style.textShadow = "0 0 40px #ff0000";
    } else {
        symbolEl.style.color = "#bc13fe";
        symbolEl.style.textShadow = "0 0 25px #bc13fe";
    }

    // 4. 显示结果区域并添加揭晓动画
    resultArea.classList.remove('hidden');
    symbolEl.classList.add('reveal-anim'); // 触发CSS中的闪现动画
}
</script>
</body>

</html>

